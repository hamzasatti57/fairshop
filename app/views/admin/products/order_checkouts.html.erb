<div class="card">
  <div class="card-header custom-card-header">
    <i class="fa fa-align-justify"></i> Listing all Order Checkouts</div>
  <div class="card-body">
    <div class="row">
      <div class="col-lg-12">
        <table id="color-table" class="table table-striped table-bordered display">
          <thead>
          <tr>
            <th>#</th>
            <th>Invoice Number</th>
            <th>Customer Pin</th>
            <th>Customer Name</th>
            <th>Amount</th>
            <th>Delivery Address</th>
            <th>Delivery Fee</th>
            <th>Transaction Date</th>
          </tr>
          </thead>
          <tbody>
          <% @checkouts.to_a.each_with_index do |checkout, index| %>
            <tr>
              <td><%= index+1 %></td>
              <td><%= (checkout.user_cart.id + 1000) if checkout.user_cart.present? %></td>
              <td><%= (checkout.user_cart.otp_code) if checkout.user_cart.present? %></td>              
              <td><%= (checkout.user.first_name + " " + checkout.user.last_name ) if checkout.user.present? %></td>
              <td>R<%= checkout.amount %></td>
              <td><%= checkout.billing_address.present? ? checkout.billing_address.address : "--" %></td>
              <% product_ids = Product.where(id: checkout.user_cart.user_cart_products.pluck(:product_id)).pluck(:product_category_id) %>
              <td><%= ProductCategory.where(id: product_ids).pluck(:delivery_fee).compact.max.to_i if ProductCategory.where(id: product_ids).pluck(:delivery_fee).present? %></td>
              <td><%= checkout.created_at.strftime("%b %d, %Y %I:%M %P") %></td>
            </tr>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<script>
    $(document).ready( function () {
        $('#color-table').dataTable();
    } );
</script>
